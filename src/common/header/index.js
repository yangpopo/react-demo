import React, { PureComponent } from 'react';
// import { HeaderWrapper, Logo } from "./style";
import "./style.scss";
import logo from '../../assets/img/nav_center.png';
import { CSSTransition } from 'react-transition-group';
import { connect } from "react-redux";
import { searchInputAnimation, getHeatDataApi, heatMouseStatus, heatPageClick } from "./store/";
import { Link } from "react-router-dom";

class Header extends PureComponent  {
    render(){
        const {focused, searchInputAnimation, heatList} = this.props;
        return (
            <header className="header-box">
                <div className="box">
                    <a href="/" className="logo-a"><img src={logo} alt="logo" /></a>
                    <nav className="nav-box">
                        <div className="menu-box">
                            <Link to="/" className="menu-link">首页</Link>
                            <Link to="/haha" className="menu-link">下载APP</Link>
                            <CSSTransition in={ focused } timeout={ 500 } classNames="slide">
                                <div className="search-box">
                                    <input type="text" placeholder="搜索" onFocus={ () => {searchInputAnimation(heatList)} } onBlur={ () => {searchInputAnimation(heatList)} }  />
                                    <CSSTransition in={ focused } timeout={ 500 } classNames="btn">
                                        <svg className="icon-search-but" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3067"><path d="M889.4 850.4L737.8 697.7c57.8-68.1 86.8-154.7 81.8-244-5-90.2-44.3-173.8-110.5-235.2-64.5-59.8-148.4-92.8-236.3-92.8-45.2 0-89.2 8.6-130.8 25.5-43.1 17.5-81.7 43.1-114.8 76.3-63.9 63.9-100 148.8-101.7 239.2-1.7 90.4 31.3 176.6 92.7 242.8 33.4 36 73.1 64 117.9 83.1 43.4 18.5 89.4 27.9 136.8 27.9 82.2 0 161.8-29.2 224.5-82.4L847 890.7c5.6 5.9 13.2 9.2 21.3 9.2 7.5 0 14.7-2.8 20.1-8 11.7-11.1 12.2-29.7 1-41.5zM474 763.1C314.7 763 185 633.2 184.8 474c0-159.5 129.7-289.2 289.2-289.2S763.2 314.5 763.2 474c-0.1 159.4-129.8 289.1-289.2 289.1z" p-id="3068"></path></svg>
                                    </CSSTransition>
                                    { this.heatSearchShow() }
                                </div>
                            </CSSTransition>
                        </div>
                        <div className="more-box">
                            <Link to="/" className="mode-switch"><svg className="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4531"><path d="M240.8704 250.31168H338.9952l217.6 552.41216H464.01024l-53.01248-142.35648H168.07424l-53.01248 142.35648H23.2704l217.6-552.41216z m-46.68416 340.42368h190.69952l-93.37344-249.9072h-3.16416l-94.1568 249.9072zM813.66016 391.89504c60.13952 0 104.448 14.69952 132.93568 44.10368 24.5248 25.52832 37.18656 62.6688 37.18656 111.4112v255.31392H906.24v-56.4736a169.58976 169.58976 0 0 1-59.3408 47.96416c-26.9056 12.38016-58.55744 19.34336-94.95552 19.34336-42.73152 0-75.96544-10.83392-99.70176-31.72352-26.112-20.8896-38.77376-47.96928-38.77376-81.23392 0-44.8768 18.2016-79.6928 54.59968-103.68 33.2288-23.20896 80.70656-34.816 140.84608-36.36224l91.78624-2.31936v-16.24576c0-55.7056-30.85824-83.5584-92.57984-83.5584-26.112 0-47.47264 4.63872-63.29856 13.9264-18.9952 10.8288-30.86336 27.07968-35.6096 49.5104l-83.08224-6.9632c8.704-43.32032 30.85824-75.81696 65.67424-95.93344 30.06976-18.57024 71.2192-27.07968 121.856-27.07968z m87.04 225.92l-86.2464 2.31936c-76.75392 1.54624-114.7392 27.8528-114.7392 77.36832 0 15.47264 6.33344 27.8528 19.78368 37.9136 12.66176 10.05568 30.06976 15.47264 51.43552 15.47264 35.60448 0 65.67424-10.83392 90.99264-31.72352 25.32352-20.8896 38.77376-47.19616 38.77376-78.14144v-23.20896z" fill="#6F6F6F" p-id="4532"></path></svg></Link>
                            <Link to="/" className="date"><svg className="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8560"><path d="M1019.30752 344.012008c-63.2393-89.925079-126.480646-179.889043-189.725062-269.833565-5.632277-8.894577-15.85306-15.20633-26.348088-15.20633l-307.738873 0-19.116383 0L196.690086 58.972113c-9.405207 0-16.522302 3.52529-21.412682 8.846482-0.163729 0.168846-0.326435 0.335644-0.490164 0.509606-0.059352 0.074701-0.12382 0.143263-0.187265 0.217964-1.476631 1.599428-2.871397 3.406586-4.133134 5.460362C115.051741 164.004261 59.657107 254.027577 4.24303 344.012008c-7.16212 11.641131-4.637624 25.411763 3.261277 34.772968 0.469698 0.697895 0.960885 1.38658 1.484817 2.053776C165.861964 581.492724 322.719454 782.200932 479.581038 982.848765c6.860245 8.78099 15.216563 11.543917 23.125697 10.31595 6.860245 0.010233 13.870916-2.99931 19.838837-10.31595 163.990958-200.647833 328.009546-401.356041 492.004597-602.010013 0.846274-1.033539 1.604544-2.109034 2.311649-3.207042C1024.459866 368.231619 1027.024272 354.99106 1019.30752 344.012008L1019.30752 344.012008zM934.669864 328.959174 747.672936 328.959174c21.363564-58.275241 42.720987-116.555599 64.085574-174.830841C852.72862 212.398458 893.693614 270.679839 934.669864 328.959174L934.669864 328.959174zM501.029536 134.007063c44.50461 64.97278 89.008196 129.965004 133.512806 194.95211l-271.124977 0C409.283996 263.972067 455.14858 198.989053 501.029536 134.007063L501.029536 134.007063zM660.872011 389.724119C607.85861 534.339798 554.840093 678.955476 501.836925 823.591621 450.287875 678.505221 398.546444 533.790282 344.889383 389.724119L660.872011 389.724119 660.872011 389.724119zM691.818837 305.303404c-42.366923-61.84965-84.727707-123.707486-127.08849-185.567369l195.10356 0C737.164605 181.590801 714.488139 243.449661 691.818837 305.303404L691.818837 305.303404zM310.661838 298.695916c-22.681582-59.785641-45.762253-119.441323-69.358671-178.958858l195.669448 0C394.869705 179.38353 352.764748 239.039211 310.661838 298.695916L310.661838 298.695916zM190.932966 156.657946c22.586414 57.310264 44.703131 114.748441 66.466808 172.296111L84.862162 328.954057C120.223531 271.520997 155.58183 214.08589 190.932966 156.657946L190.932966 156.657946zM280.245084 389.724119c55.512315 148.604526 108.930945 297.910017 162.123424 447.594131-116.629277-149.195997-233.253438-298.395064-349.863273-447.594131L280.245084 389.724119 280.245084 389.724119zM725.39863 389.724119l203.815989 0C806.007529 540.473495 682.813743 691.216731 559.620979 841.955874 614.872351 691.211615 670.137025 540.468378 725.39863 389.724119L725.39863 389.724119zM725.39863 389.724119" p-id="8561"></path></svg></Link>
                            <Link to="/login" className="login">登录</Link>
                            <div className="more-but">
                                <Link to="/registered" className="but">注册</Link>
                                <Link to="/publish" className="but orange"><svg className="icon" viewBox="0 0 1070 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="9449"><path d="M46.545455 977.454545h58.181818L279.272727 686.545455h174.545455C628.363636 686.545455 738.397091 238.359273 977.454545 46.545455 467.456 46.545455 162.909091 628.363636 46.545455 977.454545z m245.899636-267.636363l-174.545455 290.909091H14.242909l10.24-30.626909C202.472727 435.944727 539.554909 23.272727 977.454545 23.272727h66.187637l-51.665455 41.425455c-73.076364 58.647273-136.285091 142.010182-213.597091 271.080727a17825.978182 17825.978182 0 0 0-74.100363 126.836364c-28.811636 49.198545-50.082909 83.595636-71.121455 113.896727-61.44 88.529455-116.084364 133.306182-179.339636 133.306182H292.445091z" fill="#FFFFFF" p-id="9450"></path><path d="M46.545455 977.454545c116.363636-349.090909 420.910545-930.909091 930.90909-930.90909-239.057455 191.813818-349.090909 640-523.636363 640H279.272727L104.727273 977.454545H46.545455z" p-id="9451"></path></svg>写文章</Link>
                            </div>
                        </div>
                    </nav>
                </div>
            </header>
        )
    }

    // 热门搜索的显示
    heatSearchShow() {
        const { focused, mouseStatus, heatMouseStatus, heatList, heatListPage, heatPageClick} = this.props
        if(!focused && !mouseStatus) return;
        const newHeatListPage = heatListPage.toJS();
        const newHeatList = heatList.toJS();
        let dom = [];
        if(newHeatList.length > 0){
            for(let i = 0; i < newHeatListPage.pageSize; i++){
                let k = newHeatListPage.page === 1 ? i : i + newHeatListPage.pageSize * (newHeatListPage.page - 1);
                if(k < newHeatList.length){
                    dom.push(<a className="item" href="/" key={ newHeatList[k] }>{ newHeatList[k] }</a>)
                }else{
                    break;
                }
            }
        }
        return (
            <div className="heat-search" onMouseEnter={ heatMouseStatus } onMouseLeave={ heatMouseStatus } >
                <div className="title-box">
                    <span className="title">热门搜索</span>
                    <span className="change-but" onClick={ heatPageClick }>
                        <svg className="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1498"><path d="M824.32 686.08c-5.12 0-15.36-5.12-20.48-5.12l-122.88-122.88c-10.24-10.24-10.24-25.6 0-35.84 10.24-10.24 25.6-10.24 35.84 0l107.52 107.52 107.52-107.52c10.24-10.24 25.6-10.24 35.84 0s10.24 25.6 0 35.84l-122.88 122.88c-10.24 0-15.36 5.12-20.48 5.12z m-501.76-128c-5.12 0-15.36-5.12-20.48-5.12l-102.4-107.52-107.52 107.52c-10.24 10.24-25.6 10.24-35.84 0-10.24-10.24-10.24-25.6 0-35.84l122.88-128c10.24-10.24 25.6-10.24 35.84 0l122.88 128c10.24 10.24 10.24 25.6 0 35.84 0 5.12-5.12 5.12-15.36 5.12z" p-id="1499"></path><path d="M486.4 870.4c-87.04 0-174.08-35.84-235.52-97.28-92.16-92.16-122.88-230.4-76.8-353.28 0-10.24 15.36-20.48 30.72-15.36 10.24 5.12 20.48 20.48 15.36 35.84-35.84 102.4-10.24 220.16 66.56 296.96 87.04 92.16 225.28 112.64 337.92 51.2 10.24-5.12 25.6 0 35.84 10.24 5.12 10.24 0 25.6-10.24 35.84-56.32 25.6-107.52 35.84-163.84 35.84z m343.04-204.8H819.2c-15.36-5.12-20.48-20.48-15.36-30.72 35.84-102.4 10.24-220.16-66.56-296.96-87.04-87.04-225.28-112.64-337.92-51.2-10.24 5.12-25.6 0-35.84-10.24 0-20.48 5.12-35.84 15.36-40.96 128-71.68 291.84-46.08 399.36 61.44 92.16 92.16 117.76 230.4 76.8 353.28-5.12 5.12-15.36 15.36-25.6 15.36z" p-id="1500"></path></svg>换一批</span>
                </div>
                <div className="item-box">
                    { dom }
                </div>
            </div>
        );
    }
}


// 链接redux数据
const mapStateToProps = (state) => {
    return {
        focused: state.get("headerReducer").get("focused"),
        heatList: state.get("headerReducer").get("heatList"),
        mouseStatus: state.get("headerReducer").get("mouseStatus"),
        heatListPage: state.get("headerReducer").get("heatListPage")
    }
}

// 链接处理方法
const mapDispatchToProps = (dispatch, ownProps) => {
    return {
        // 获取或失去焦点
        searchInputAnimation(heatList) {
            if(heatList.size === 0) dispatch(getHeatDataApi()); // 获取热门标签
            dispatch(searchInputAnimation());// 搜索框动画
        },

        // 鼠标移上或者移开
        heatMouseStatus(){
            dispatch(heatMouseStatus())
        },

        // 热门标签翻页
        heatPageClick() {
            dispatch(heatPageClick())
        }
    }
}

export default connect(mapStateToProps, mapDispatchToProps)(Header)